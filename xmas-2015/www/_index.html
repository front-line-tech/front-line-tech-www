<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>time machine</title>
	
	<link href='https://fonts.googleapis.com/css?family=Electrolize' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="themes/green-screen-3.min.css" />
	<link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" />
	
	<link rel="stylesheet" href="css/offline-theme-default.css" />
	<link rel="stylesheet" href="css/offline-language-english.css" />
	<link rel="stylesheet" href="css/app.css" />
	<style>
      body, .ui-btn { font-family: 'Electrolize', sans-serif; }
	</style>
	
	<link rel="stylesheet" href="css/glitch.css" />
	
	<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
	<script src="http://code.jquery.com/jquery-migrate-1.2.1.js"></script>

	<script src="js/baasbox-0.8.4.min.js"></script>

	<script src="js/geo.js"></script>
	<script src="js/appSounds.js"></script>

	<script src="js/app.js"></script>
	<script src="js/appUI.js"></script>
	<script src="js/appPageTeamData.js"></script>
	<script src="js/appPageMap.js"></script>
	<script src="js/appPageContent.js"></script>
	<script src="js/compass.js"></script>
	<script src="js/appCompass.js"></script>

	<script src="js/typewriting.min.js"></script>
	
	<script src="js/jquery.jqpuzzle.packed.js"></script>
	<link rel="stylesheet" href="css/jquery.jqpuzzle.css" />
	
	<script src="js/offline.min.js"></script>
	<script src="js/jaaulde-cookies.js"></script>

	<!-- maps --><!-- &callback=initMap -->
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAlToxdKEXAXkca52t1rhEv7_mBQKcTf7Y">
    </script>
	
	<!-- initialisation -->
	<script>
	$(document).ready(function() {
        BaasBox.setEndPoint("https://services.front-line-tech.com:445");
        BaasBox.appcode = "1234567890";
		
		// basic app initialisation
		app.init();
		
		Offline.options = {
			// checks: {xhr: {url: "https://52.16.214.196:445" + '/assets/favicon'}},
			checks: {xhr: {url: "http://front-line-tech.com/favicon.ico"}},
			requests: false
		};
	});
	
	var runOfflineCheck = function() {
		console.log('offline check...');
		if (Offline.state === 'up') {
			Offline.check();
		}
		console.log('offline state: ' + Offline.state);
	}

	</script>
	
</head>
<body>
	<!-- page-login -->
	<div data-role="page" data-theme="b" id="page-login">
		<div data-role="header" data-position="inline">
			<h1>game connection</h1>
		</div>
		<div data-role="content">
			
			Welcome! Please enter your team name below to join the game.<br/>
			
			<p style="color: #cc0000;">
				<b>When asked, please <u>allow</u> access to your location.</b>
				Without location data you will not be sent certain clues in the game.
			</p>
			
			<input type="text" id="input-gamename" value="timescape" placeholder="game" disabled="disabled" style="display: none;" />
			<input type="text" id="input-teamname" data-clear-btn="true" placeholder="mission code" />
			
			<button id="btn-connect">connect</button>
			
			<script>
			$(document).ready(function() {
				
				var user_id = cookies.get('last_user_identity');
				if (user_id !== null) {
					console.log('identified previous username by cookie: ' + user_id);
					$('#input-teamname').val(user_id);
				}
				
				$('#btn-connect').on('click', function() {
					var username = $('#input-teamname').val();
					var game = $('#input-gamename').val();
					var password = username;
					
					cookies.set('last_user_identity', username);
					
					app.login(username, password, game);
				});
			});
			</script>
			
		</div>
	</div>
	<!-- /page-login -->

	<!-- page-team-summary -->
	<div data-role="page" data-theme="a" id="page-team-summary">
		
		<div data-role="panel" id="page-team-side-panel">
    		<!-- panel content goes here -->

			<button
				class="btn-show-keyword-dialog ui-btn ui-corner-all ui-btn-icon-left ui-icon-edit">
				Submit keyword...
			</button>

			<button
				class="btn-show-map-page ui-btn ui-corner-all ui-btn-icon-left ui-icon-location">
				City map...
			</button>
			
			<button id="btn-help-team-page"
				class="ui-btn ui-corner-all ui-btn-icon-left ui-icon-info">
				Help...
			</button>

		</div><!-- /panel -->

		<!-- data-overlay-theme="a" data-theme="a" -->
		<div data-role="popup" id="popup-new-events" data-dismissible="true" data-position-to="window"
			data-overlay-theme="a" data-theme="a">
            <div data-role="header" data-theme="a">
                <h1>incoming...</h1>
            </div>
            <div role="main" class="ui-content" id="popup-new-events-content-div">
                <span id="text-popup-new-events"></span>
            </div>
		</div>


		<div data-role="header" data-position="inline">
			<h1>Team Summary</h1>

			<a class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-left ui-btn-icon-notext ui-icon-bars"
				href="#page-team-side-panel">
				Menu
			</a>
			<button id="btn-refresh-team-page"
				class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-left ui-btn-icon-notext ui-icon-refresh">
				Refresh
			</button>
		</div>
		
		<div data-role="content">
			
			<!--
			<audio src="audio/whistle.wav" preload="auto" id="game-whistle">
			</audio>
			-->
			
			<div class="ui-body ui-body-a ui-corner-all">
				
				<!-- quick links -->
				<div style="position: absolute; right: 5px;">					
					<button
						class="btn-show-keyword-dialog ui-btn ui-btn-inline ui-corner-all ui-btn-icon-left ui-btn-icon-notext ui-icon-edit">
					</button>
					<button
						class="btn-show-map-page ui-btn ui-btn-inline ui-corner-all ui-btn-icon-left ui-btn-icon-notext ui-icon-location">
					</button>
				</div>

				<!-- score so far -->
				<h3>
					Mission <span id="text-score-percent">0</span>% complete.<br/>
					Received <span id="text-clues-total">[...]</span> items.
				</h3>
				
				<!-- found clues -->
				<!-- data-filter="true" data-filter-placeholder="Search clues..." -->
				<ul id="team-events-list" data-role="listview" data-inset="true" data-split-icon="location">
				</ul>
				<span id="no-events-text">
					No items received yet.
					<ul>
						<li><button class="ui-btn ui-btn-inline ui-shadow ui-corner-all ui-icon-location ui-btn-icon-notext"></button> (top right) displays the ciy map.</li>
						<li><button class="ui-btn ui-btn-inline ui-shadow ui-corner-all ui-icon-edit ui-btn-icon-notext"></button> (top right) to enter a keyword.</li>
						<li><button class="ui-btn ui-btn-inline ui-shadow ui-corner-all ui-icon-bars ui-btn-icon-notext"></button> (top left) opens the menu.</li>
						<li><button class="ui-btn ui-btn-inline ui-shadow ui-corner-all ui-icon-refresh ui-btn-icon-notext"></button> (top right) to refresh the data.</li>
					</ul>
				</span>
			</div>
			
			<script>
			$(document).ready(function() {
				
				$('.btn-show-keyword-dialog').on('click', function() {
					$(":mobile-pagecontainer").pagecontainer("change",
						"#page-submit-keyword", 
						{ role: "dialog" });
				});

				$('.btn-show-map-page').on('click', function() {
					$(":mobile-pagecontainer").pagecontainer("change",
						"#page-map", 
						{ transition : "slide" });
				});
				
				$('#btn-refresh-team-page').on('click', function() {
					app.doCheckin();
				});
				
				$('#btn-help-team-page').on('click', function() {
					$(":mobile-pagecontainer").pagecontainer("change",
						"#page-help", 
						{ transition: "flip" });
				});
			});
			</script>
			
		</div>
	</div>
	<!-- /page-team-summary -->

	<!-- page-submit-keyword -->
	<div data-role="page" data-theme="a" id="page-submit-keyword">
		<div data-role="header" data-position="inline">
			
			<h1>Submit keyword</h1>
		</div>
		
		<div data-role="content">
			<!-- activation -->
			<!-- <h3>Keyword entry</h3> -->
			<input id="input-trigger-keyword" type="text" data-clear-btn="true" placeholder="keyword" />
			<button id="btn-trigger-keyword" data-mini="true" data-inline="true">submit</button>		
		</div>
		
		<script>
			$(document).ready(function() {
				$('#btn-trigger-keyword').on('click', function() {
					var keyword = $('#input-trigger-keyword').val();
					console.log('doing checkin with keyword: ' + keyword);
					app.checkin(app.coords.latitude, app.coords.longitude, app.coords.altitude, keyword, pageTeamData.refresh, true);
					$('.ui-dialog').dialog('close');
				});
			});
		</script>
		
	</div>

	<!-- page-map -->
	<div data-role="page" data-theme="a" id="page-map">
		<div id="page-map-header-div" data-role="header" data-position="inline" data-add-back-btn="true">
			<h1>City map</h1>
			<a class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-left ui-btn-icon-notext ui-icon-carat-l"
				data-rel="back">
				Back
			</a>
			<button id="btn-centre-map"
				class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-left ui-btn-icon-notext ui-icon-user">
				Centre
			</button>
		</div>
		<div data-role="content" style="margin: 0; padding: 0;">
			<div id="map" style="position:absolute; width:100%;"><!--height:95%--></div>
		</div>
		<script>
		$(document).ready(function() {
			$('#btn-centre-map').on('click', function() {
				pageMap.centre(app.coords.latitude, app.coords.longitude);
			});
		});
		</script>
	</div>
	<!-- /page-map -->

	<!-- page-team-summary -->
	<div data-role="page" data-theme="a" id="page-help">
		<div data-role="header" data-position="inline">
			<h1>Help</h1>
			<a class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-left ui-btn-icon-notext ui-icon-carat-l"
				data-rel="back">
				Back
			</a>
		</div>
		
		<div data-role="content">
			<h4>Find clues by submitting keywords!</h4>
			<ul>
				<li>Some keywords will only work in the right location.</li>
				<li>Some clues will appear when you get to a location automatically.</li>
			</ul>

			<h4>Tools</h4>
			
			<ul>
				<li><button class="ui-btn ui-btn-inline ui-shadow ui-corner-all ui-icon-location ui-btn-icon-notext"></button> show the city map</li>
				<li><button class="ui-btn ui-btn-inline ui-shadow ui-corner-all ui-icon-edit ui-btn-icon-notext"></button> enter a keyword</li>
				<li><button class="ui-btn ui-btn-inline ui-shadow ui-corner-all ui-icon-refresh ui-btn-icon-notext"></button> refresh your team data</li>
				<li><button class="ui-btn ui-btn-inline ui-shadow ui-corner-all ui-icon-user ui-btn-icon-notext"></button> centre the map on you</li>
			</ul>
			
			<p>
				Use the back button (top left) to go back to your team page.
			</p>

			<h4>Does everybody in my team need to enter every keyword?</h4>
			<p>
				No -- you are all synced, and other players in your team will see what you see. It can take up
				to 30 seconds for everybody to sync up. You can expedite this with the refresh button (top right).
			</p>
			
			<h4>I think I'm not getting clues at locations...</h4>
			<p>
				If you accidentally pressed <b>Deny</b> for location, the game won't work - as you will not be able to
				receive some clues. You are going to have to work out how to enable location again in the browser!
			</p>

			<h4>The map's just blank / new tiles don't load</h4>
			<p>
				You may have been out of signal as the map tried to load. When you get back into better signal,
				refresh the app in your browser and sign in again. Don't worry -- all your team items will still
				be there!
			</p>
		</div>
	</div>
	
	<div data-role="page" data-theme="a" id="page-content">
		<div data-role="header" data-position="inline">
			<h1><span id="page-content-title">...</span></h1>
			<a class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-left ui-btn-icon-notext ui-icon-carat-l"
				data-rel="back">
				Back
			</a>
		</div>

		<div data-role="content" id="page-content-content">
		</div>
	</div>
	
</body>
</html>
